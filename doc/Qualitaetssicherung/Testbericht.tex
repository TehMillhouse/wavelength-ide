\documentclass[parskip=full,11pt,openany]{scrreprt}

\usepackage[sfdefault,light]{roboto}
\usepackage{inconsolata}
\usepackage[ngerman]{babel}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{microtype}

\usepackage{csquotes}
\MakeOuterQuote{"}

\usepackage{graphicx}
\usepackage{float}
\usepackage{bm}
\usepackage{amssymb}
\usepackage[hidelinks]{hyperref}
\usepackage[section]{placeins}
\usepackage{booktabs}

\usepackage{amsmath}

\usepackage{enumitem} 

\usepackage{amssymb}% http://ctan.org/pkg/amssymb
\usepackage{pifont}% http://ctan.org/pkg/pifont
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}% 

\usepackage{fourier} 
\usepackage{array}
\usepackage{makecell}

%Change enummeration pattern from 1. to 1)
\renewcommand\labelenumi{\theenumi)}

%align lambda terms left, no spacing before or after environment
\newenvironment{nospaceflalign*}
 {\setlength{\abovedisplayskip}{0pt}\setlength{\belowdisplayskip}{0pt}%
  \csname flalign*\endcsname}
 {\csname endflalign*\endcsname\ignorespacesafterend}


\titlehead{\centering\includegraphics[width=6cm]{img/logo.pdf}}
\title{Testbericht}
\subtitle{Wavelength--$\bm{\lambda}$-IDE}
\author{Muhammet Guemues, Markus Himmel, Marc Huisinga,\\Philip Klemens, Julia Schmid, Jean-Pierre von der Heydt}

\begin{document}
\maketitle
\newpage
\tableofcontents
\newpage

\chapter{Überblick}

\section{Einleitung}
%TODO kurze Einleitung. Verwendete Tools, Daten (Coverage, #Testcases)

\section{Änderungen in der Applikation}
%TODO Änderungen in der Spezifikation oder dem Design

\section{Abdeckung der Tests im Pflichtenheft}

%TODO Die folgende Tabelle greift die im Pflichtenheft definierten Test auf und 

\begin{table}[h]
	\centering
	\begin{tabular}{@{}ll|c|r@{}}
		\toprule
		&\textbf{Test Nr.} & \textbf{Getestet} &\textbf{Anmerkung} \\ 
		\midrule
		\multicolumn{3}{l|}{\small \textsc{\textbf{T1} Komplettauswertung}} \\ 
		&T1.1 & \cmark & \\
		&T1.2 & (\cmark) & Das Verhalten des Editors wurde nicht getestet \\
		&T1.3 & \cmark & \\ 
		\multicolumn{4}{l}{\small \textsc{\textbf{T2} Schritt-für-Schritt-Modus}}\\ 
		&T2.1 & \cmark & An die neue Benutzeroberfläche angepasst \\
		&T2.2 - T2.9 & \cmark & \\
		\multicolumn{4}{l}{\small \textsc{\textbf{T3} Erstellen von Permalinks}}\\ 	
		&T3.1 - T3.4 & \cmark & \\
		\multicolumn{3}{l|}{\small \textsc{\textbf{T4} Übungsmodus}}\\ 
		&T4.1 & \cmark & \\
		&T4.2 - T4.3 & (\xmark) & Feature wurde in der Entwurfsphase verworfen \\
		&T4.4 & \cmark & \\
		&T4.5 & (\xmark) & Feature wurde in der Entwurfsphase verworfen \\
		&T4.6 & \cmark & \\
		&T4.7 & (\xmark) & Es existiert keine Übungsaufgabe der geforderten Form \\
		&T4.8 - T4.9 & \cmark & \\
		\multicolumn{3}{l|}{\small \textsc{\textbf{T5} Ausgabeformat}}\\ 
		&T5.1 & \cmark & \\
		&T5.2 & (\xmark) & Feature wurde in der Implementierungsphase verworfen\\
		&T5.3 & \xmark & Wurde nur manuell getestet \\ %TODO Anmerkung in einem Text
		\multicolumn{2}{l|}{\small \textsc{\textbf{T6} Export}} & &\\ 
		&T6.1 - T6.3 & \cmark & \\
		\multicolumn{3}{l|}{\small \textsc{\textbf{T7} Namensbindung}}\\ 
		&T7.1 - T7.2 & \cmark & \\
		&T7.3 & \cmark & Spezifikation für doppelte Namensbindung wurde geändert \\ %TODO Anmerkung in einem Text
		\multicolumn{4}{l}{\small \textsc{\textbf{T8} Auswahl des Ausgabeumfangs}}\\ 
		&T8.1 - T8.2 & \cmark & \\
		&T8.3 & \xmark & Wurde nur manuell getestet \\ %TODO Anmerkung in einem Text
		\multicolumn{4}{l}{\small \textsc{\textbf{T9} Wechsel des Auswertungsmodus}}\\ 
		&T9.1 - T9.2 & \cmark & \\
		&T9.3 & \cmark & An die neue Benutzeroberfläche angepasst \\
		\multicolumn{3}{l|}{\small \textsc{\textbf{T10} Standardbibliothek}}\\ 
		&T10.1 - T10.7 & \cmark & \\
		&T10.8 - T10.9 & \cmark & Bibliotheksfunktionen umbenannt und leicht angepasst \\
		\multicolumn{3}{l|}{\small \textsc{\textbf{T11} Fehlerdiagnostik}}\\ 
		&T11.1 & \xmark & \\
		&T11.2 & \xmark & \\
		&T11.3 & \xmark & \\
		&T11.4 & \xmark & \\
		&T11.5 & \xmark & \\
		\bottomrule
	\end{tabular}
	\caption{Übersicht zur Abdeckung der Test aus dem Pflichtenheft}
\end{table}


\chapter{Testmethoden}
%TODO Coverage, wie viel? warum nur im Model?
%TODO Was war möglich? was nicht?

\section{Komponententest}
%TODO text

\section{Selenium}
%TODO text

\section{Parser-Fuzzing}
Neben herkömmlichen JUnit-Tests und dem Parsen von zufällig generierten
$\lambda$-Termen kam zum Testen des Parsers ein Fuzzer zum Einsatz. Fuzzing ist
eine Testtechnik, bei der nach dem Modell eines genetischen Algorithmus
automatisch interessante Testfälle generiert werden, die neue interne Zustände
in der Applikation hervorrufen. Da der Fuzzer introspektiv mit der kompilierten
Applikation arbeitet, werden innerhalb von kurzer Zeit Testfälle gefunden, die
neue Ausnahmen oder Zustände hervorrufen.

Wavelength verwendet zum Fuzzen des Parsers die Java-Bibliothek
\textit{Javan Warty Pig\footnote{\url{https://github.com/cretz/javan-warty-pig}}},
welche die Instrumentationsfeatures der Java Virtual Machine nutzt, um Fuzzing
auf der Ebene des Java Bytecodes durchzuführen.

Durch das gezielte Suchen des Fuzzers nach neuen Programmzuständern ist der
Fuzzer in der Lage, innerhalb von Sekunden gültige $\lambda$-Terme und
Namenszuweisungen zu generieren, ohne vorher mit Informationen über die Struktur
von $\lambda$-Termen initialisiert zu werden. Ebenfalls konnte der Fuzzer innerhalb
von kurzer Zeit mehrere unerwartete Ausnahmen im Parser hervorrufen und syntaktisch
inkorrekte Testfälle generieren, die dennoch vom Parser akzeptiert wurden. Einige
dieser Bugs wären ohne die Verwendung eines Fuzzers mit hoher Wahrscheinlichkeit
unentdeckt geblieben.

Bei der Verwendung des Fuzzers wurden jedoch auch die Limitationen dieser Methodik
zum Testen deutlich. Der Fuzzer such spezifisch nach neuen internen Zuständen und
Ausführungspfaden. Fehlverhalten, welches nicht zu einer Verzweigung im
Programmfluss führt, ist für den Fuzzer somit nicht sichtbar. Im Fall des
Wavelength-Parsers wird dieser Umstand im Bezug auf Kommentare in der Eingabe
am deutlichsten -- im Parser existieren keine Branches, die abhängig vom
Vorhandensein eines Kommentars genommen werden. Das Resultat ist, dass durch
Fuzzen keine interessanten Testfälle zum Umgang mit Kommentaren gefunden werden.
Insbesondere gab es einen subtilen Fehler in der Kommentarentfernungsreoutine,
der auf den ersten Blick wie ein typischer durch einen Fuzzer indentifizierbarer
Fehlerfall aussieht, vom Fuzzer jedoch nicht entdeckt wurde. Daher stützen wir
uns zum Testen des Parsers nicht nur auf Fuzzing, sondern auch auf herkömmliche
manuell erstellte Komponententests.

Neben dem Beheben der durch Fuzzing identifizierten Fehler wurden die entsprechenden
Testfälle in Unittests festgehalten, um Regressionen entgegenzuwirken.

\chapter{Testprotokolle}

\section{UI Tests}
%TODO Begründung warum keine Unittests



\subsection{Ausgabe}

\subsubsection{Unicode: Syntax Test}
Bei diesem Test ist lediglich die Syntax der Ausgabe relevant. Markierungen werden in späteren Tests abgedeckt.
Dieser Test wird mit folgenden Einstellungen durchgeführt: Reduktionsordnung 'Normal Order' und Ausgabegröße 'Full'. Es wurde immer die gesamte Ausgabe (sofern der Term terminiert) auf Syntaxfehler überprüft.


Die nachfolgenden Tests wurden mit folgenden Eingaben getestet:

\begin{nospaceflalign*}
	&\lambda x.\, x \\
	&(\lambda x.\, x)\: x \\
	&(\lambda x.\, x\: x\: x)\: (\lambda x.\, x\: x\: x) \\
	&(\lambda a.\, a)\: b\: (\lambda c.\, c)\: d \\
	&(\lambda a.\, a)\: b \: ((\lambda c.\, c)\: d) \\
	&(\lambda a.\, \lambda b.\, b)\: ((\lambda c.\, (\lambda d.\, d\: d)\: (\lambda e.\, e\: e))\: ((\lambda f.\, f)\: (\lambda g.\, g)))\: (\lambda h.\, \lambda i.\, i)&&
\end{nospaceflalign*}

\begin{nospaceflalign*}
	& \text{id} = \lambda x.\, x \\
	& \text{id}\ x &&
\end{nospaceflalign*}

%TODO: mehr Terme

\subsubsection{Unicode: Syntax Test}
Bei diesem Test ist lediglich die Syntax der Ausgabe relevant. Markierungen werden in späteren Tests abgedeckt.
Dieser Test wird mit folgenden Einstellungen durchgeführt: Reduktionsordnung 'Normal Order' und Ausgabegröße 'full'. Es wurde immer die gesamte Ausgabe (sofern der Term terminiert) auf Syntaxfehler überprüft.

\subsubsection{Unicode: Highlight Tests}

\paragraph{Redexe}
Nur Redexe im  Term werden als anklickbar markiert und ob nur diese lösen bei Klick eine Reaktion aus. Alle nicht markierten Teile des Terms sind nicht klickbar und lösen keine Reaktion aus.


\paragraph{Mouse-over}
Dieser Test testet das korrekte Verhalten bei Bewegen der Maus über Lambda-Terme. Nur bei hovern über einem Redex erscheint eine Markierung, diese erstreckt sich über den gesamten Redex. Weiterhin wird bei mouse-over die Markierung der Reduktionsordnung entfernt. 


Nur Redexe im  Term werden als anklickbar markiert und ob nur diese lösen bei Klick eine Reaktion aus. Alle nicht markierten Teile des Terms sind nicht klickbar und lösen keine Reaktion aus. %TODO: link to issue

\paragraph{Mouse-over}
Dieser Test testet das korrekte Verhalten bei Bewegen der Maus über Lambda-Terme. Nur bei hovern über einem Redex erscheint eine Markierung, diese erstreckt sich über den gesamten Redex. Weiterhin wird bei mouse-over die Markierung der Reduktionsordnung entfernt. 
\paragraph{Hintergrund}
Jeder neue Term wird in einer neuen Zeile ausgegeben und verschiedene Terme werden durch verschiedene Hintergrundfarben unterscheidbar gemacht.


\subsubsection{Unicode: Schritt vor}
Bei Schritt vor bleibt (per Button oder manuellem Klick) die Markierung des ausgewerteten Redex korrekt erhalten. Weiterhin sind Redexe im ursprünglichen Term nicht mehr anklickbar und auch bei mouse-over zeigen diese keine Reaktion. Der neu angezeigte Term verhält sich wie in den vorherigen Tests spezifiziert.

\subsubsection{Unicode: Schritt zurück}
Test1: 
Im Ausgabefenster wird ein einzelner Term angezeigt. Bei Schritt zurück wird dieser entfernt und das Ausgabefenster ist leer. 
Dieser Test funktioniert unabhängig von einem bestimmten Term.

Test2: 
Im Ausgabefenster wird mehr als ein Term angezeigt. Bei Schritt zurück wird der zuletzt angezeigte Term entfernt.
Beim nun letzten Term werden die Markierungen zurückgesetzt, das bedeutet, dass die Markierung des reduzierten Redex durch die Markierung der aktuell gewählten Reduktionsordnung ersetzt wird. Weiterhin sind nun alle Redexe wieder klickbar und mouse-over verhält sich wie oben getestet.

\subsubsection{Unicode: Reduktionsordnung}
Bei Änderung der Reduktionsordnung wird der zuletzt angezeigte Term entsprechend der neuen Reduktionsordnung neu markiert. 

\subsubsection{Baum: Highlight Tests}
Nur Knoten von Redexen werden im Baum als solche farblich markiert.

\subsubsection{Baum: Änderung der Reduktionsordnung}
%TODO: siehe git issue
Bei Änderung der Reduktionsordnung wird der zuletzt angezeigte Baum entsprechend der neuen Reduktionsordnung neu gefärbt.


\subsubsection{Unicode: Reduktionsordnung}
Bei Änderung der Reduktionsordnung wird der zuletzt angezeigte Term entsprechend der neuen Reduktionsordnung neu markiert. 

\subsubsection{Baum: Highlight Tests}
Nur Knoten von Redexen werden im Baum als solche farblich markiert. Dabei ist der Knoten mit dem Redex, welcher als nächstes ausgewertet wird anders markiert als die übrigen Redexe.

\subsubsection{Baum: Änderung der Reduktionsordnung}
%TODO: siehe git issue
Bei Änderung der Reduktionsordnung wird der zuletzt angezeigte Baum entsprechend der neuen Reduktionsordnung neu gefärbt. Die restlichen Bäume behalten ihre bisherige Färbung bei.

\subsubsection{Baum: Schritt vor und Schritt zurück}
Test1: Bei Schritt nach vorne bleibt die Knotenfärbung des aktuellen Baumes erhalten.

Test2: Bei Schritt nach vorne wird der neu anzuzeigende Baum unter den restlichen Bäumen in die Ausgabe eingefügt. Alle anderen Bäume bleiben unverändert.

Test3: Bei Schritt zurück wird der aktuelle Baum aus der Ausgabe entfernt und der nun letzte Baum ist entsprechend der gewählten Reduktionsordnung neu gefärbt.

\subsubsection{Formatwechsel}
Test1: Bei nicht leerem Ausgabefenster und einem Wechsel des Ausgabeformats wird nur der zuletzt angezeigte Term neu geladen entsprechend des neuen Formats. Die restlichen angezeigten Terme bleiben unverändert.

Test2: Bei Schritt vor (per Button, manuell oder durch Wiederaufnehmen der automatischen Ausführung) wird der neue Term entsprechend des neu gewählten Ausgabeformats angezeigt. 

Test3: Ein Formatwechsel hat keine Auswirkung auf bereits angezeigte Terme bei Schritt zurück. Diese werden in ihrem alten Ausgabeformat angezeigt (und ggf. neu markiert, siehe obige Tests).

Test4: Bei Formatwechsel bleibt die Hintergrundfärbung der Unicode-Terme konsistent. %TODO: Link zu git issue einfuegen



\chapter{Fehlerprotokoll}
%TODO Fehler Sortieren und Kategorisieren

\begin{itemize}[itemsep=3ex]

\newcommand{\issue}[3]{%
\item[]
\begin{itemize}[noitemsep]
\item[]\textbf{#1}
\item[\textbf{Grund:}]#2
\item[\textbf{Behebung:}]#3
\end{itemize}}

%issue 44
\issue{Wird die Position eines Fehlers in der Eingabe ausgegeben, ist die rechte Grenze des Positionsintervalls genau um Eins größer als erwartet.}
{arg2}{arg3}

%issue 43
\issue{In den Exportformaten Plaintext, Unicode ud LaTeX wird ein Reduktionspfeil vor dem Ausgangstermin der ersten Zeile ausgegeben.}
{arg2}{arg3}

%issue 41

%issue 34

%issue 33
\issue{arg1}{arg2}{arg3}

%issue 31
\issue{arg1}{arg2}{arg3}

%issue 27
\issue{Wird die Lösung einer aktiven Übungsaufgabe angezeigt und eine neue Aufgabe geöffnet, wird das Lösungsfenster nicht geschlossen, sondern die Lösung der neuen Aufgabe angezeigt. }
{Beim Öffnen einer neuen Übungsaufgabe wird der Status des Lösungsfensters nicht zurückgesetzt.}
{Die LoadExercise Action setzt nun den Status des Lösungsfensters zurück, bevor eine neue Übungsaufgabe angezeigt wird}

%issue 26
\issue{Wenn eine Rechnung in TreeOutput erfolgt und die Applikation anschließend serialisiert wird, werden die Teilschritte im UnicodeOutput angezeigt.}
{}
{}

%issue 23
\issue{Beim Öffnen einer neuen Redex-Übungsaufgabe kommt es manchmal zu einem Fehler.}
{Enthält der gesuchte Redex eine gebundene Variable, deren bindende Abstraktion außerhalb des Redex liegt, ist der Redex-Subterm kein valider Lambda-Term, was zu einem Fehler bei der Ausgabe als String führt.}
{Vor der Ausgabe wird ein bereinigter Term für die Ausgabe erstellt. In diesem Term wurden alle gebundenen Variablen deren bindende Abstraktion nicht innerhalb des Redex liegt durch freie Variablen mit dem Namen der abstrahierten Variable ersetzt.}

% issue 19
\issue{}{}{}

% issue 18
\issue{}{}{}

% issue 16
\issue{Namenszuweisungen schattieren einander nicht, sondern es wird immer die erste Zuweisung verwendet.}
{Die zugewiesenen Namen wurden in der falschen Reiehenfolge zur Auflösung durchsucht.}
{Die Durchsuchungsreihenfolge wurde umgekehrt.}

% issue 14; TODO 
\issue{Die farbliche Abgrenzung der Terme im Unicode-Ausgabeformat verhält sich nicht korrekt bei mehrmaligem Formatwechsel. Der Hintergrund zweier aufeinanderfolgender Terme wird bei Wechsel, Schritt vor und Schritt zurück gleich gefärbt.}{Alle Interaktion des Ausgabefensters, unabhängig von der Wahl des Formats, haben Einfluss auf die Hintergrundfarbe.}{Die Hintergrundfarbe wird nur verändert, wenn Terme im Unicodeformat hinzugefügt, entfernt oder manipuliert werden.}

% issue 13; TODO
\issue{Bei Wechseln des Ausgabeformats sind verschiedene Formate in der Ausgabe gemischt angezeigt. Schritt zurück resultiert in Konvertierung des zuletzt angezeigten Terms in das neue Ausgabeformat.}{Formatwechsel während einer Ausgabe wurden nicht deaktiviert. Dies ist ein Resultat des neuen Workflows. %TODO: hier kann Marc evtl mehr zu schreiben
}{Formatwechsel ist nun möglich, auch während einer laufenden Auswertung. Dabei wird nur der zuletzt angezeigte und alle folgenden Terme entsprechend des neuen Ausgabeformats geladen. Die bisher angezeigten Terme bleiben in ihrem ursprünglichen Format erhalten und werden bei Schritt zurück auch entsprechend dieses Formats behandelt.}

% issue 12; TODO
\issue{Veränderungen an von einer Übungsaufgabe vorgegebenen Term  werden beim Laden eines Serialisierungs-Links nicht wiederhergestellt, stattdessen wird der ursprünglich vorgegebene Term angezeigt.}
{Beim der Deserialisieren des Anwendungszustands wird zwar der Inhalt des Eingabefeldes wiederhergestellt, befand sich die Anwendung zum Zeitpunkt der Serialisierung jedoch im Übungsmodus, wird dieser daraufhin mit dem vorgegebenen Term überschrieben.}
{Der Inhalt des Eingabefeldes wird nun nach der Wiederherstellung der Übungsaufgabe wiederhergestellt und der vorgegebene Term gegebenenfalls überschrieben.}

% issue 11;TODO
\issue{Bestimmte syntaktisch inkorrekte Namenszuweisungen führen zu Ausnahmen oder werden akzeptiert.}
{Der Parser hat Zeilen, die das Symbol \enquote{\texttt{=}} mehrfach enthalten, nicht als Syntaxfehler identifiziert und
alles ab dem zweiten \enquote{\texttt{=}}-Symbol verworfen.}
{Namenszuweisungen, die nicht exakt aus einem Namen, einem \enquote{\texttt{=}}-Symbol und einem gültigen
$\lambda$-Term bestehen, werden abgelehnt.}

% issue 8; TODO
\issue{}{}{}

% issue 7
\issue{Im Unicode-Ausgabeformat werden benannte Term nicht markiert, auch wenn sie den als nächstes zu reduzierenden Redex enthalten.}
{Bei benannten Termen wird nicht überprüft, ob er einen Redex repräsentiert.}
{Ein benannter Term wird jetzt bezüglich der Markierung je nach innerer Repräsentation behandelt.}

% issue 6; TODO
\issue{}{}{}

% issue 5; TODO
\issue{}{}{}

% issue 4
\issue{Enthält ein $\lambda$-Term verschiedene Instanzen des gleichen vordefinierten Terms, so werden, sobald eine Instanz reduziert wird, auch alle anderen Instanzen reduziert.}
{Der Mechanismus zur Auflösung gebundener Namen hat für den gleichen Namen stets das gleiche Objekt
herausgegeben, sodass die Objektstruktur, die den geparsten Term repräsentiert, kein echter Baum war.}
{Benannte Terme werden vor dem Einbauen dupliziert.}

\end{itemize}


\end{document}
